{"version":3,"file":"windowed-observable.cjs.development.js","sources":["../src/observable.ts"],"sourcesContent":["import { Events, Observer, Observers } from './types';\n\nexport const EVENTS = '__events__';\nexport const SHARED = '__shared__';\nexport const OBSERVERS = '__observers__';\n\nexport class Observable<T = any> {\n  private _namespace!: string;\n\n  // istanbul ignore next\n  private static initialize() {\n    if (!window[SHARED]) {\n      window[SHARED] = {\n        [EVENTS]: {},\n        [OBSERVERS]: {},\n      };\n    }\n\n    if (!window[SHARED][EVENTS]) {\n      window[SHARED][EVENTS] = {};\n    }\n\n    if (!window[SHARED][OBSERVERS]) {\n      window[SHARED][OBSERVERS] = {};\n    }\n  }\n\n  constructor(namespace: string) {\n    Observable.initialize();\n\n    this.namespace = namespace;\n  }\n\n  set namespace(namespace: string) {\n    this._namespace = namespace;\n\n    // istanbul ignore next\n    if (!this.events) this.events = [];\n\n    // istanbul ignore next\n    if (!this.observers) this.observers = [];\n  }\n\n  private get events(): Events<T> {\n    return window[SHARED][EVENTS][this._namespace];\n  }\n\n  private set events(newEvents: Events<T>) {\n    window[SHARED][EVENTS][this._namespace] = newEvents;\n  }\n\n  private get observers(): Observers<T> {\n    return window[SHARED][OBSERVERS][this._namespace];\n  }\n\n  private set observers(newObservers: Observers<T>) {\n    window[SHARED][OBSERVERS][this._namespace] = newObservers;\n  }\n\n  getEvents(): Events<T> {\n    return this.events;\n  }\n\n  getLastEvent(): T | undefined {\n    const events = this.events;\n    if (!events.length) {\n      return;\n    }\n\n    const lastEvent = events[events.length - 1];\n\n    return lastEvent;\n  }\n\n  publish(data: T): void {\n    const events = this.events;\n    const lastEvent = this.getLastEvent();\n\n    this.observers.forEach((observer) => observer(data, { events, lastEvent }));\n\n    this.events.push(data);\n  }\n\n  dispatch = this.publish;\n\n  subscribe(observer: Observer<T>): void {\n    this.observers = this.observers.concat(observer);\n  }\n\n  unsubscribe(observer: Observer<T>): void {\n    this.observers = this.observers.filter((obs) => obs !== observer);\n  }\n\n  clear(): void {\n    const events = this.events;\n    const lastEvent = this.getLastEvent();\n\n    this.observers.forEach((observer) =>\n      observer(undefined, { events, lastEvent })\n    );\n\n    this.events = [];\n    this.observers = [];\n  }\n}\n"],"names":["EVENTS","SHARED","OBSERVERS","Observable","namespace","publish","initialize","window","getEvents","events","getLastEvent","length","lastEvent","data","observers","forEach","observer","push","subscribe","concat","unsubscribe","filter","obs","clear","undefined","_namespace","newEvents","newObservers"],"mappings":"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"}